    .rentroll-table.compact .note-col {
        width: auto;
        font-size: 11px;
        color: #666;
    }<!-- 렌트롤 영역 개선 버전 -->
<!-- 기존 index.html의 렌트롤 영역을 다음과 같이 교체 -->

<div class="rentroll-section">
    <div class="section-title">📊 렌트롤</div>
    
    <!-- 렌트롤 시계열 입력 폼 -->
    <div class="rentroll-input-form disabled" id="rentrollInputForm">
        <!-- 렌트롤 기준 시점 선택 - 현재 년월 기본값 설정 -->
        <div class="rentroll-input-row" style="background: #fff3cd; padding: 8px; border-radius: 4px; margin-bottom: 8px;">
            <select id="rentrollYearInput" style="flex: 1;">
                <option value="">기준년도 선택</option>
            </select>
            <select id="rentrollMonthInput" style="flex: 1;">
                <option value="">기준월 선택</option>
                <option value="01">1월</option>
                <option value="02">2월</option>
                <option value="03">3월</option>
                <option value="04">4월</option>
                <option value="05">5월</option>
                <option value="06">6월</option>
                <option value="07">7월</option>
                <option value="08">8월</option>
                <option value="09">9월</option>
                <option value="10">10월</option>
                <option value="11">11월</option>
                <option value="12">12월</option>
            </select>
        </div>
        
        <!-- 기존 렌트롤 입력 필드 -->
        <div class="rentroll-input-row">
            <input type="number" class="floor-input" id="floorInput" placeholder="층">
            <input type="text" id="tenantInput" placeholder="입주사명">
        </div>
        <div class="rentroll-input-row">
            <div class="contract-period-group">
                <input type="text" id="contractFromInput" placeholder="시작" readonly>
                <span>~</span>
                <input type="text" id="contractToInput" placeholder="종료" readonly>
            </div>
            <input type="text" id="rentrollNoteInput" placeholder="비고">
        </div>
        <div class="rentroll-buttons">
            <button class="rentroll-save-button" onclick="saveRentroll()">저장</button>
            <button class="rentroll-cancel-button" onclick="cancelRentroll()">취소</button>
        </div>
    </div>
    
    <!-- 필터 섹션 -->
    <div style="display: flex; gap: 8px; margin-bottom: 8px; padding: 8px; background: #f8f9fa; border-radius: 4px;">
        <select id="filterRentrollYear" onchange="filterRentrolls()" style="flex: 1; padding: 4px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;">
            <option value="">전체 년도</option>
        </select>
        <select id="filterRentrollMonth" onchange="filterRentrolls()" style="flex: 1; padding: 4px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;">
            <option value="">전체 월</option>
            <option value="01">1월</option>
            <option value="02">2월</option>
            <option value="03">3월</option>
            <option value="04">4월</option>
            <option value="05">5월</option>
            <option value="06">6월</option>
            <option value="07">7월</option>
            <option value="08">8월</option>
            <option value="09">9월</option>
            <option value="10">10월</option>
            <option value="11">11월</option>
            <option value="12">12월</option>
        </select>
    </div>
    
    <div class="rentroll-list" id="rentrollList">
        <div class="empty-state">렌트롤 정보가 없습니다</div>
    </div>
</div>

<!-- CSS 추가 스타일 -->
<style>
    /* 렌트롤 테이블 개선 스타일 */
    .rentroll-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 10px;
        border-radius: 6px 6px 0 0;
        margin-bottom: -1px;
        font-size: 13px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .rentroll-header-title {
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .rentroll-header-meta {
        font-size: 11px;
        opacity: 0.9;
    }
    
    .rentroll-table-wrapper {
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 0 0 6px 6px;
        margin-bottom: 15px;
    }
    
    .rentroll-table.compact {
        margin-bottom: 0;
    }
    
    .rentroll-table.compact th {
        background: #f8f9fa;
        font-size: 10px;
        padding: 5px 8px;
    }
    
    .rentroll-table.compact td {
        padding: 5px 8px;
        font-size: 11px;
    }
    
    .rentroll-table.compact .author-col {
        width: 100px;
        font-size: 10px;
        color: #666;
        cursor: help;
    }
    
    .rentroll-table.compact .action-cell {
        width: 60px;
        text-align: center;
    }
    
    .rentroll-action-btn {
        padding: 2px 6px;
        border: 1px solid #dee2e6;
        background: white;
        border-radius: 3px;
        cursor: pointer;
        font-size: 10px;
        color: #666;
        transition: all 0.2s;
    }
    
    .rentroll-action-btn:hover {
        background: #f8f9fa;
        border-color: #adb5bd;
    }
    
    .rentroll-footer {
        background: #f8f9fa;
        padding: 6px 10px;
        font-size: 10px;
        color: #666;
        border-top: 1px solid #dee2e6;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .rentroll-count {
        font-weight: 600;
        color: #495057;
    }
    
    .new-badge {
        background: #ff6b6b;
        color: white;
        padding: 1px 4px;
        border-radius: 10px;
        font-size: 9px;
        margin-left: 5px;
        animation: pulse 1.5s infinite;
    }
</style>

<!-- JavaScript 수정 부분 -->
<script type="module">
// 전역 변수에 최신 렌트롤 정보 저장
window.latestRentrollDate = null;

// 년도 선택 옵션 초기화 함수 (현재 년월 기본값 추가)
window.initializeRentrollYearSelects = function() {
    const currentDate = new Date();
    const currentYear = currentDate.getFullYear();
    const currentMonth = String(currentDate.getMonth() + 1).padStart(2, '0');
    const selects = ['rentrollYearInput', 'filterRentrollYear'];
    
    selects.forEach(selectId => {
        const select = document.getElementById(selectId);
        if (select) {
            // 기존 옵션 유지 (첫번째 옵션)
            const firstOption = select.options[0];
            select.innerHTML = '';
            if (firstOption) {
                select.appendChild(firstOption);
            }
            
            // 년도 옵션 추가
            for (let year = currentYear + 2; year >= currentYear - 10; year--) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year + '년';
                select.appendChild(option);
            }
            
            // 입력 폼에는 현재 년도를 기본값으로 설정
            if (selectId === 'rentrollYearInput') {
                select.value = currentYear;
            }
        }
    });
    
    // 입력 폼에 현재 월을 기본값으로 설정
    const monthInput = document.getElementById('rentrollMonthInput');
    if (monthInput) {
        monthInput.value = currentMonth;
    }
};

// 최신 렌트롤 날짜 가져오기
window.getLatestRentrollDate = async function() {
    if (!window.currentBuildingId) return null;
    
    try {
        let rentrolls = [];
        
        if (window.database) {
            const rentrollRef = window.firebaseRef(window.database, `rentrolls/${window.currentBuildingId}`);
            const snapshot = await window.firebaseGet(rentrollRef);
            
            if (snapshot.exists()) {
                rentrolls = Object.entries(snapshot.val()).map(([id, data]) => ({
                    id,
                    ...data
                }));
            }
        } else {
            rentrolls = JSON.parse(localStorage.getItem(`rentrolls_${window.currentBuildingId}`) || '[]');
        }
        
        if (rentrolls.length === 0) return null;
        
        // 가장 최신 렌트롤 찾기 (기준년월 기준)
        rentrolls.sort((a, b) => {
            const dateA = parseInt(a.targetYear) * 100 + parseInt(a.targetMonth || 0);
            const dateB = parseInt(b.targetYear) * 100 + parseInt(b.targetMonth || 0);
            return dateB - dateA;
        });
        
        const latest = rentrolls[0];
        return {
            year: latest.targetYear,
            month: latest.targetMonth
        };
        
    } catch (error) {
        console.error('최신 렌트롤 날짜 조회 오류:', error);
        return null;
    }
};

// 렌트롤 목록 로드 (개선된 UI)
window.loadRentrolls = async function() {
    const rentrollList = document.getElementById('rentrollList');
    
    if (!window.currentBuildingId) {
        rentrollList.innerHTML = '<div class="empty-state">빌딩을 선택하세요</div>';
        return;
    }
    
    try {
        let rentrolls = [];
        
        if (window.database) {
            const rentrollRef = window.firebaseRef(window.database, `rentrolls/${window.currentBuildingId}`);
            const snapshot = await window.firebaseGet(rentrollRef);
            
            if (snapshot.exists()) {
                rentrolls = Object.entries(snapshot.val()).map(([id, data]) => ({
                    id,
                    ...data
                }));
            }
        } else {
            rentrolls = JSON.parse(localStorage.getItem(`rentrolls_${window.currentBuildingId}`) || '[]');
        }
        
        if (rentrolls.length === 0) {
            rentrollList.innerHTML = '<div class="empty-state">렌트롤 정보가 없습니다</div>';
            
            // 렌트롤이 없으면 입력 폼에 현재 년월 설정
            const currentDate = new Date();
            const currentYear = currentDate.getFullYear();
            const currentMonth = String(currentDate.getMonth() + 1).padStart(2, '0');
            
            document.getElementById('rentrollYearInput').value = currentYear;
            document.getElementById('rentrollMonthInput').value = currentMonth;
            
            return;
        }
        
        // 최신 렌트롤 날짜 저장
        const latestDate = await getLatestRentrollDate();
        window.latestRentrollDate = latestDate;
        
        // 처음 로드시 최신 날짜로 필터 설정
        if (!document.getElementById('filterRentrollYear').value && 
            !document.getElementById('filterRentrollMonth').value && 
            latestDate) {
            document.getElementById('filterRentrollYear').value = latestDate.year;
            document.getElementById('filterRentrollMonth').value = latestDate.month;
        }
        
        // 필터링 적용
        const filterYear = document.getElementById('filterRentrollYear')?.value;
        const filterMonth = document.getElementById('filterRentrollMonth')?.value;
        
        if (filterYear) {
            rentrolls = rentrolls.filter(r => r.targetYear === parseInt(filterYear));
        }
        
        if (filterMonth) {
            rentrolls = rentrolls.filter(r => r.targetMonth === filterMonth);
        }
        
        if (rentrolls.length === 0) {
            rentrollList.innerHTML = '<div class="empty-state">선택한 기간의 렌트롤 정보가 없습니다</div>';
            return;
        }
        
        // 기준년월별로 그룹화
        const groupedByDate = {};
        rentrolls.forEach(rentroll => {
            const key = `${rentroll.targetYear}-${rentroll.targetMonth}`;
            if (!groupedByDate[key]) {
                groupedByDate[key] = [];
            }
            groupedByDate[key].push(rentroll);
        });
        
        // 각 그룹을 층수 기준으로 정렬
        Object.keys(groupedByDate).forEach(key => {
            groupedByDate[key].sort((a, b) => {
                const floorA = parseInt(a.floor) || 0;
                const floorB = parseInt(b.floor) || 0;
                return floorA - floorB;
            });
        });
        
        // 정렬된 그룹 키 (최신순)
        const sortedKeys = Object.keys(groupedByDate).sort((a, b) => {
            const [yearA, monthA] = a.split('-').map(Number);
            const [yearB, monthB] = b.split('-').map(Number);
            const dateA = yearA * 100 + monthA;
            const dateB = yearB * 100 + monthB;
            return dateB - dateA;
        });
        
        const threeDaysAgo = Date.now() - (3 * 24 * 60 * 60 * 1000);
        
        // HTML 생성
        let html = '';
        sortedKeys.forEach(key => {
            const [year, month] = key.split('-');
            const group = groupedByDate[key];
            
            // 최신 작성 시간과 작성자 찾기
            const latestEntry = group.reduce((latest, current) => 
                current.timestamp > latest.timestamp ? current : latest
            );
            
            const hasNew = group.some(r => r.timestamp > threeDaysAgo);
            
            html += `
                <div class="rentroll-header">
                    <div class="rentroll-header-title">
                        📅 ${year}년 ${month}월 렌트롤
                        ${hasNew ? '<span class="new-badge">NEW</span>' : ''}
                    </div>
                    <div class="rentroll-header-meta">
                        최종 수정: ${formatDateTime(latestEntry.timestamp)}
                    </div>
                </div>
                <div class="rentroll-table-wrapper">
                    <table class="rentroll-table compact">
                        <thead>
                            <tr>
                                <th class="floor-col">층</th>
                                <th class="tenant-col">입주사명</th>
                                <th class="contract-col">계약기간</th>
                                <th class="note-col">비고</th>
                                <th class="author-col">작성자</th>
                                <th class="action-cell">관리</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            group.forEach(rentroll => {
                const isRecent = rentroll.timestamp > threeDaysAgo;
                html += `
                    <tr>
                        <td class="floor-col">${rentroll.floor || '-'}</td>
                        <td class="tenant-col">${rentroll.tenant || '-'}</td>
                        <td class="contract-col">${rentroll.contractPeriod || '-'}</td>
                        <td class="note-col">${rentroll.note || '-'}</td>
                        <td class="author-col" title="${formatDateTime(rentroll.timestamp)}">
                            ${rentroll.author.split('@')[0]}
                            ${isRecent ? '<span style="color: #ff6b6b; font-size: 9px;">●</span>' : ''}
                        </td>
                        <td class="action-cell">
                            ${(rentroll.author === window.currentUser || window.isAdmin) ? `
                                <button class="rentroll-action-btn" onclick="editRentroll('${rentroll.id}')" title="편집">✏️</button>
                                <button class="rentroll-action-btn" onclick="deleteRentroll('${rentroll.id}')" title="삭제">🗑️</button>
                            ` : '-'}
                        </td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                    <div class="rentroll-footer">
                        <span class="rentroll-count">총 ${group.length}개 층</span>
                        <span>작성자 ${[...new Set(group.map(r => r.author))].length}명</span>
                    </div>
                </div>
            `;
        });
        
        rentrollList.innerHTML = html;
        
        // 입력 폼에 최신 날짜 설정 (편집 중이 아닐 때만)
        if (latestDate && !window.editingRentrollId) {
            document.getElementById('rentrollYearInput').value = latestDate.year;
            document.getElementById('rentrollMonthInput').value = latestDate.month;
        }
        
    } catch (error) {
        console.error('렌트롤 로드 오류:', error);
        rentrollList.innerHTML = '<div class="empty-state">데이터 로드 실패</div>';
    }
};

// 렌트롤 저장 함수는 기존과 동일
window.saveRentroll = async function() {
    if (!window.currentUser) {
        alert('먼저 로그인하세요');
        return;
    }
    
    if (!window.currentBuildingId) {
        alert('빌딩 정보가 없습니다');
        return;
    }
    
    const targetYear = document.getElementById('rentrollYearInput').value;
    const targetMonth = document.getElementById('rentrollMonthInput').value;
    const floor = document.getElementById('floorInput').value.trim();
    const tenant = document.getElementById('tenantInput').value.trim();
    const contractFrom = document.getElementById('contractFromInput').value.trim();
    const contractTo = document.getElementById('contractToInput').value.trim();
    const note = document.getElementById('rentrollNoteInput').value.trim();
    
    if (!targetYear || !targetMonth) {
        alert('렌트롤 기준 년도와 월을 선택하세요');
        return;
    }
    
    if (!floor || !tenant) {
        alert('층과 입주사명은 필수입니다');
        return;
    }
    
    try {
        const rentrollData = {
            targetYear: parseInt(targetYear),
            targetMonth: targetMonth,
            targetDate: `${targetYear}-${targetMonth}`,
            floor: floor,
            tenant: tenant,
            contractFrom: contractFrom,
            contractTo: contractTo,
            contractPeriod: contractFrom && contractTo ? `${contractFrom}~${contractTo}` : '',
            note: note,
            author: window.currentUser,
            timestamp: Date.now(),
            createdAt: new Date().toISOString(),
            buildingId: window.currentBuildingId,
            buildingName: window.currentBuildingData?.['빌딩명'] || window.currentBuildingData?.name || ''
        };
        
        if (window.database) {
            if (window.editingRentrollId) {
                await window.firebaseUpdate(
                    window.firebaseRef(window.database, `rentrolls/${window.currentBuildingId}/${window.editingRentrollId}`),
                    rentrollData
                );
                window.editingRentrollId = null;
            } else {
                await window.firebasePush(
                    window.firebaseRef(window.database, `rentrolls/${window.currentBuildingId}`),
                    rentrollData
                );
            }
        } else {
            const rentrolls = JSON.parse(localStorage.getItem(`rentrolls_${window.currentBuildingId}`) || '[]');
            
            if (window.editingRentrollId) {
                const index = rentrolls.findIndex(r => r.id === window.editingRentrollId);
                if (index !== -1) {
                    rentrolls[index] = { ...rentrolls[index], ...rentrollData };
                }
                window.editingRentrollId = null;
            } else {
                rentrollData.id = Date.now().toString();
                rentrolls.push(rentrollData);
            }
            
            localStorage.setItem(`rentrolls_${window.currentBuildingId}`, JSON.stringify(rentrolls));
        }
        
        // 저장 후 층과 입주사만 초기화 (년월은 유지)
        document.getElementById('floorInput').value = '';
        document.getElementById('tenantInput').value = '';
        document.getElementById('contractFromInput').value = '';
        document.getElementById('contractToInput').value = '';
        document.getElementById('rentrollNoteInput').value = '';
        if (window.contractFromPicker) window.contractFromPicker.clear();
        if (window.contractToPicker) window.contractToPicker.clear();
        
        // 필터를 저장한 데이터의 년월로 설정
        document.getElementById('filterRentrollYear').value = targetYear;
        document.getElementById('filterRentrollMonth').value = targetMonth;
        
        loadRentrolls();
        window.updateRentrollBadge();
        
    } catch (error) {
        console.error('저장 오류:', error);
        alert('저장 중 오류가 발생했습니다');
    }
};

// 렌트롤 입력 필드 초기화 (년월 유지 옵션 추가)
window.clearRentrollInputs = function(keepDate = false) {
    if (!keepDate) {
        document.getElementById('rentrollYearInput').value = '';
        document.getElementById('rentrollMonthInput').value = '';
    }
    document.getElementById('floorInput').value = '';
    document.getElementById('tenantInput').value = '';
    document.getElementById('contractFromInput').value = '';
    document.getElementById('contractToInput').value = '';
    document.getElementById('rentrollNoteInput').value = '';
    if (window.contractFromPicker) window.contractFromPicker.clear();
    if (window.contractToPicker) window.contractToPicker.clear();
};

// 탭 전환시 렌트롤 로드
const originalSwitchTab = window.switchTab;
window.switchTab = function(tabName) {
    originalSwitchTab.call(this, tabName);
    
    if (tabName === 'rentroll') {
        // 렌트롤 탭 열 때마다 최신 데이터로 필터 설정
        setTimeout(async () => {
            await loadRentrolls();
        }, 100);
    }
};

// formatDateTime 함수
window.formatDateTime = function(timestamp) {
    const date = new Date(timestamp);
    const month = (date.getMonth() + 1).toString().padStart(2, '0');
    const day = date.getDate().toString().padStart(2, '0');
    const hours = date.getHours().toString().padStart(2, '0');
    const minutes = date.getMinutes().toString().padStart(2, '0');
    
    return `${month}/${day} ${hours}:${minutes}`;
};

// DOMContentLoaded 이벤트에 추가
document.addEventListener('DOMContentLoaded', function() {
    // 기존 초기화 코드...
    
    // 렌트롤 년도 선택 초기화 (현재 년월 기본값 포함)
    window.initializeRentrollYearSelects();
});
</script>